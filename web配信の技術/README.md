# web配信の技術
書籍URL 
[https://www.amazon.co.jp/Web%E9%85%8D%E4%BF%A1%E3%81%AE%E6%8A%80%E8%A1%93%E2%80%95HTTP%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%BB%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B9%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%83%BBCDN%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B-%E7%94%B0%E4%B8%AD-%E7%A5%A5%E5%B9%B3/dp/4297119250](https://www.amazon.co.jp/Web%E9%85%8D%E4%BF%A1%E3%81%AE%E6%8A%80%E8%A1%93%E2%80%95HTTP%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%BB%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B9%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E3%83%BBCDN%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B-%E7%94%B0%E4%B8%AD-%E7%A5%A5%E5%B9%B3/dp/4297119250)


## この本を読んだ目的
キャッシュそのものの概念がよくわかっておらず、基礎的な概念と利用方法などを学びたかったため。
AWSではcloud frontを使用するだけで、良しなにしてくれるがそれ以外の箇所がブラックボックスになってため、これら箇所を把握しておきたかった。

## そもそもキャッシュとは？
本来オリジンサーバーが処理を行いレスポンスするコンテンツ(htmlやjson)をプロキシサーバーやクライアントのストレージに保持する技術。

## なぜキャッシュを使うのか？
- エンドユーザーへのレスポンスの向上　→　ユーザー体験の向上化 
  https://www.pingdom.com/blog/2018-pingdom-year-in-review/
- オリジンサーバーの負荷を減らしダウンすることを防ぐ
- オリジンサーバーのスケールする時間を増やす
　→　**キャッシュの負荷対策は一時的な対応と捉えるのが良い**

## キャッシュを使うメリット・デメリット
### メリット
- オリジンサーバにアクセスせず、コンテンツを取得できるのでオリジンサーバーの負荷を減らせる
- 高速でエンドユーザーにコンテンツを返却することが可能
- 本来オリジンサーバーの許容範囲が大きくなりオートスケールをする必要が少なくなり利用料金を抑えれる

### デメリット
- キャッシュされた内容が古い場合があり、最新のコンテンツではないコンテンツをレスポンスする場合がある　→　レスポンスヘッダーで対応可能
- キャッシュしたタイミングではそれぞれのエンドクライアントに異なるコンテンツを返却してしまう場合もある　→　多段プロキシをすることで対応可能
- キャッシュの仕方によってはセキュリティホールを作ってしまう可能性がある

## レスポンスヘッダーについて
httpのレスポンスヘッダーに**Cache-Control**ディレクティブで記述されている
https://e-words.jp/w/Cache-Control.html

### Cache-Control設定値について
- max-age: クライアントでキャッシュ可能な時間を指定する、キャッシュしている時間が超過している場合は、再度オリジンサーバーからコンテンツを取得する
- private: エンドクライアントのブラウザにキャッシュを行い、途中のプロキシにはキャッシュを行わない。個人情報等の他のユーザーから見えてはいけない情報等をキャッシュさせる際に指定
- no-store: キャッシャを保存させない
- no-chace: キャッシュは保存するが、都度オリジンサーバーにキャッシュされているコンテンツが最新化を問い合わせてから利用する
コンテンツが最新の場合は、オリジンサーバーからはコンテンツを取得しないので、オリジンサーバーの負荷軽減・高速化が行える

### その他のヘッダーについて
- age: エンドクライアント・プロキシサーバーにキャッシュが保存されて経過した時間

## キャッシュを使う上での注意点
- 共有してはいけない情報はキャッシュしないようにする(set-cookieレスポンスやauthorizationリクエスト等)
　→ 個人情報の流出に繋がる
- キャッシュサーバーを信用しすぎない
　→ RFCの内容がすべて実装されているとは限らないので、使用する際は公式ドキュメントを読んで仕様を確認する

 
## まとめ
キャッシュの役割については主に
- スケーリングまでの時間を稼ぐ
- オリジンサーバーの負荷を減らす
- エンドユーザーへのレスポンスを高速にする

といった内容があると理解しました。
また、書籍の中でエッジコンピューティングやwebページを配信する上で気を付けなければならない点(画像の大きさやコンテンツの圧縮)についても触れられており、網羅的に知識を得ることができました。
動的コンテンツの配信については、考慮すべき点やシステムの構成によってキャッシュ戦略が異なるため実務で鍛えていくしかなさそうでした。
(システム開発に銀の弾丸は無いようですね。。。)
キャッシュとは何ぞやって方や、キャッシュについて網羅的に把握したいといった方にはとてもおすすめな書籍でした。
